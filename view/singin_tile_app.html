<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Developer Test Ajax</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <!-- jQuery library -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
    <!-- Popper JS -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Tinos:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&amp;display=swap" rel="stylesheet" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link rel="stylesheet" href="styles_ajax.css">
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-12 text-left mt-5">
          <a href="file:///home/aonitcmtc/Desktop/ajax/index.html" class="btn btn-sm btn-outline-primary">Home</a>
        </div>
        <div class="col-8">
          <form action="http://localhost:3000/api/login_api" method="post">
            <input id="username" type="text" placeholder="User" value="admin2"/>
            <input id="password" type="password" placeholder="Password" value="123456789"/>
            <input id="location" type="text" placeholder="Location"/>
            <input id="url" type="text" placeholder="URL"/>
            <textarea placeholder="Message"></textarea>
            <div class="d-inline-flex">
              <input id="send_ajax" type="button" value="Send" />
              &ensp;<i class="text-warning fa fa-spinner fa-spin" style="font-size:24px; display: none;"></i>
            </div>
          </form>
        </div>
        <div class="col-3 mt-5">
          <label for="response">Response ::</label>
          <textarea id="response" placeholder=""></textarea>

          <label for="decode64">Decode ::</label>
          <textarea id="decode64" placeholder=""></textarea>
        </div>
      </div>
    </div>
  </body>
</html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script> -->
<script>
  $(document).ready(function(){

    var url = $(location).attr('href')

    function encodeToMD5(input) {
      var md5Hash = CryptoJS.MD5(input);
      var md5String = md5Hash.toString(CryptoJS.enc.Hex);
      return md5String;
    }

    // function fixBase64Padding(base64String) {
    //   while (base64String.length % 4) {
    //     base64String += '=';
    //   }
    //   return base64String;
    // }

    fetch('http://jsonip.com?callback=?')
    .then(response => response.text())
    .then(data => {
      jsonpData = data.substring(data.indexOf("{"), data.lastIndexOf("}") + 1);
      user_location = JSON.parse(jsonpData);
      console.log(user_location)
      $('#location').val(user_location.ip)
      $('#url').val(url)
    });

    $('#send_ajax').on('click', function() {
      // encryptAndLogData('data', 'key_val')
      $('.fa-spinner').show()
      var token ={
          user: $('#username').val(),
          pass: $('#password').val(),//btoa(encodeToMD5()) ,
          location: $('#location').val(),
          url: url
        }

      token = JSON.stringify(token)
      console.log(token)

      $.ajax({
        url: 'http://localhost:3000/api/login_api',
        type: 'POST',
        dataType: 'json',
        data: {
          token: btoa(token),
          user: $('#username').val(),
        },
        success: function(response) {
          console.log('Success:', response);
          $('#response').val(response.result)
          // $('#decode64').val(atob(response.result)) // Decode Ajax
          $('.fa-spinner').hide()
        },
        error: function(error) {
          console.error('Error:', error);
        }
      });
    });

    // Usage
    async function encryptAndLogData(data, key_val) {
      // var encrypted = CryptoJS.AES.encrypt(data, encodeToMD5(key_val));
      // return encrypted.toString()

      const sign = require('jwt-encode');
      const secret = 'secret';
      const is_data = {
        sub: '1234567890',
        name: 'John Doe',
        iat: 1516239022
      };
      const jwt = sign(is_data, secret);
      console.log('jwt::::');
      console.log(jwt);
    }

  });
</script>