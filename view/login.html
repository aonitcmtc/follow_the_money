<!DOCTYPE html>
<html lang="en">
<head>
    <title>follow the money</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- bootstrap@4.6.2 -->
    <link rel="stylesheet" href="../script/bootstrap4.6.2_lib/bootstrap.min.css">
    <script src="../script/bootstrap4.6.2_lib/jquery.slim.min.js"></script>
    <script src="../script/bootstrap4.6.2_lib/popper.min.js"></script>
    <script src="../script/bootstrap4.6.2_lib/bootstrap.bundle.min.js"></script>
    <!-- font-awesome-4.7 -->
    <link rel="stylesheet" href="../script/font-awesome-4.7.0/css/font-awesome.min.css">
    <!-- datepicker-thai -->
    <link href="../script/bootstrap-datepicker-thai/css/datepicker.css" rel="stylesheet">
    <script type="text/javascript" src="../script/bootstrap-datepicker-thai/js/bootstrap-datepicker.js"></script>
    <script type="text/javascript" src="../script/bootstrap-datepicker-thai/js/bootstrap-datepicker-thai.js"></script>
    <script type="text/javascript" src="../script/bootstrap-datepicker-thai/js/locales/bootstrap-datepicker.th.js"></script>
    <!-- Encryp MD5 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.18.0/js/md5.min.js"></script>
    <!-- jquery-cookie-master -->
    <script src="../script/jquery-cookie-master/src/jquery.cookie.js"></script>
    <!-- sweetalert2 -->
    <script src="../script/sweetalert2@11.js"></script>
</head>
<body>

<div class="jumbotron text-center jumbo-mb-0">
  <h1>Follow the Money</h1>
  <p>Resize this responsive page to see the effect!</p> 
</div>

<div class="row">
    <div class="col-sm-8 col-md-8 col-lg-8 col-xl-7 mt-5">
        <div class="ml-5">
            <a href="../index.html" class="btn btn-outline-danger">
                <i class="fa fa-home" aria-hidden="true"></i>
                Home
            </a>
        </div>

        <div class="row justify-content-center">
            <div class="col-12 text-center">


            </div>
        </div>

    </div>
    <div class="col-sm-4 col-md-4 col-lg-4 col-xl-3 mt-5 f-18">
        <form method="post" name="hello-sheet">
            <div class="form-row">
                <input type="hidden" id="ctrl" name="ctrl" value="checkLogin">
                <div class="col-md-12 col-xl-10 mb-2">
                <label for="email_user">Email</label>
                <input type="text" class="form-control" id="email_user" name="email_user" value="" required>

                </div>
                <div class="col-md-12 col-xl-10 mb-2">
                <label for="password">Password</label>
                <input type="password" class="form-control" id="password" name="password" value="" required>
                </div>
            </div>
            <div class="form-row">
                <div class="col-md-12 col-xl-10 mt-2 m-login">
                    <button id='checkLogin' class="btn btn-primary w-100" type="submit">
                        <strong>
                        Login
                        </strong>
                    </button>
                    <div class="mt-2 f-14">
                        <a href="#">ลืมรหัสผ่าน</p>
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="col-md-12 col-xl-10 mt-2">
                    <hr>
                </div>
            </div>
            <div class="form-row">
                <div class="col-md-12 col-xl-10 mt-2">
                    <a href="singup.html" class="btn btn-success w-100">
                        <strong>
                        Singup
                        </strong>
                    </a>
                </div>
            </div>
        </form> 
    </div>
</div>

<script>
    $(".datepicker").datepicker({
        language:'th-th',
        format:'dd/mm/yyyy',
        autoclose: true
    });
</script>

</body>
</html>

<style>
    .jumbo-mb-0 {
        margin-bottom: 0px;
    }

    .date-input {
        border-color: #4335dc;
        background-image: url("img/svg/date-range.svg");
        background-repeat: no-repeat;
        background-position: right calc(0.375em + 0.1875rem) center;
        background-size: 24px;
    }
    .f-18 {
        font-size: 18px;
    }

    .f-14 {
        font-size: 14px;
    }

    .w-100 {
        width: 100%;
    }

    .m-login {
        margin-bottom: -29px; 
    }
</style>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzF3MJCzESCim7x1rSEE9WO2xO7DZMS8UJMr5ez9t_IlcrDYEpVUXtaQBGy-q6L35uDMA/exec'
    const form = document.forms['hello-sheet']
    var url = scriptURL

    form.addEventListener('submit', e => {
        e.preventDefault()

        let timerInterval
        Swal.fire({
            title: 'Welcom To MyBlock',
            html: '<span>Go to Page in <b></b></span>',
            icon: 'warning',
            timer: 3000,
            timerProgressBar: true,
            didOpen: () => {
                Swal.showLoading()
                const b = Swal.getHtmlContainer().querySelector('b')
                timerInterval = setInterval(() => {
                b.textContent = Swal.getTimerLeft()
                }, 100)
            },
            willClose: () => {
                clearInterval(timerInterval)
            }
            }).then((result) => {
            /* Read more about handling dismissals below */
            if (result.dismiss === Swal.DismissReason.timer) {
                console.log('I was closed by the timer')
            }
        })

        fetch(scriptURL, { 
            method: 'POST', 
            body: new FormData(form)})
            .then(response => response.json())
            .then(data => {
                console.log(data);
                if(data.result == 'success'){
                    name = $('#email_user').val();
                    local_name = md5('FollowTheMoney')
                    local_val = md5('FollowTheMoneyValue')

                    localStorage.setItem(local_name, name); // SET USER
                    localStorage.setItem(local_val, data.leval); // SET LEVEL USER
                    // console.log(localStorage.getItem(local_name));
                    // console.log(localStorage.getItem(local_val));

                    $('#email_user').val('');
                    $('#password').val('');

                    redirectToWelcome();
                    // Swal.fire({
                    //     title: 'Email หรือ Password ไม่ถูกต้อง',
                    //     icon: 'success',
                    //     timer: 500,
                    //     showConfirmButton: false,
                    //     showCancelButton: false,
                    //     didOpen: () => {
                    //         // Swal.showLoading()
                    //     },
                    //     willClose: () => {
                    //         clearInterval(timerInterval)
                    //     }
                    //     }).then((result) => {
                    // })

                }else{
                    Swal.fire({
                        title: 'Email หรือ Password ไม่ถูกต้อง',
                        html: '<h4 class="text-danger">กรุณากรอก Email&Password อีกครั้ง</h4>',
                        icon: 'error',
                        timer: 2000,
                        showConfirmButton: false,
                        showCancelButton: false,
                        didOpen: () => {
                            // Swal.showLoading()
                        },
                        willClose: () => {
                            clearInterval(timerInterval)
                        }
                        }).then((result) => {
                    })
                }
            })
            .catch(error => console.error('Error!', error.message))
    })

    $('#checkLogin').click(function(){
        get_searchName()
    });

    function get_searchName() {
      var Email = $('#email_user').val();
      var Pass = md5($('#password').val());
      $('#password').val(Pass)
    }

    function redirectToWelcome() {
        window.location.href = 'welcome.html';
    }

    function init() {
        // Check User Login
        local_name = md5('FollowTheMoney')
        local_val = md5('FollowTheMoneyValue')
        console.log(localStorage.getItem(local_name));
        console.log(localStorage.getItem(local_val));
        // localStorage.clear();

        if(localStorage.getItem(local_name) != null){
            redirectToWelcome();
        }
    }

    init();
</script>